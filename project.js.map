{"version":3,"sources":["project.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length","Animation","module","Fire","_RFpush","createAnimation","animInfo","frame","str","animFrames","startIdx","count","num","name","cc","spriteFrameCache","getSpriteFrame","push","delay","createAnimAction","animate","_RFpop","BattleMng","getRandomInt","min","max","Math","floor","random","Class","extends","Behavior","onLoad","this","uiManager","engine","getCurrentSceneN","getChildByName","fighters","getChildren","players","enemies","fighter","isEnemy","registerInput","self","eventManager","addListener","event","EventListener","KEYBOARD","onKeyPressed","keyCode","KEY","space","launchRandomAttack","TOUCH_ONE_BY_ONE","onTouchBegan","touch","availableFighters","filter","canMove","randIdx","attacker","target","moveToAttack","playPop","indexOf","FXManager","FXType","defineEnum","Blood","Boom","Dust","Hit","Flash","animData","getAnimInfo","fxType","SimpleFX","Sprite","extend","ctor","parent","type","_super","fxID","addChild","nameStr","setName","animAction","callback","callFunc","onPlayEnd","runAction","sequence","newAnim","removeFromParent","pool","putInPool","statics","properties","fxAtlasAsset","default","url","Runtime","SpriteAtlas","addSpriteFrames","instance","_spawnFX","fx","hasObject","getFromPool","playFX","pos","scaleX","p","setScale","setScaleX","setPosition","Fighter","moveForwardDuration","moveBackwardDuration","attackFreezeDuration","hurtFX","attackOffset","idleTexture","Texture","atkTexture","targetFighter","origZ","getLocalZOrder","flash","setOpacity","actionMoveForward","actionMoveBackward","actionIdle","repeatForever","scaleTo","getScaleX","targetPos","selfPos","x","y","moveTo","easing","easeCubicActionOut","idle","stopAction","setLocalZOrder","orgiZ","_assignTarget","_playAttack","getParent","hurt","offset","move1","moveBy","easeElasticInOut","move2","_onHurtEnd","seq1","flash1","fadeIn","flash2","fadeOut","seq2","jumpTo","_showAtkPose","setTexture","_showIdlePose","_playHitFreeze","setTimeout","_moveBack","bind","seq","_onAtkEnd","UIMng","icons","playerIcons","enemyIcons","origScale","icon","actionPop","easeBackOut","index"],"mappings":"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","file":"project.js","sourcesContent":["require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({\"Animation\":[function(require,module,exports){\nFire._RFpush(module, '1c3ccoPotRNBJp4DlfcdGM9', 'Animation');\n// scripts/Animation.js\n\n\"use strict\";\n\nvar createAnimation = function createAnimation(animInfo) {\n    var animFrames = [];\n    var frame, str;\n    // init run animation\n    for (var i = animInfo.startIdx; i < animInfo.startIdx + animInfo.count; i++) {\n        var num = i;\n        // if (num < 10) {\n        //     num = \"0\" + i;\n        // }\n        str = animInfo.name + num + \".png\";\n        frame = cc.spriteFrameCache.getSpriteFrame(str);\n        animFrames.push(frame);\n    }\n    return new cc.Animation(animFrames, animInfo.delay);\n};\n\nvar createAnimAction = function createAnimAction(animInfo) {\n    return cc.animate(createAnimation(animInfo));\n};\n\nmodule.exports = {\n    createAnimation: createAnimation,\n    createAnimAction: createAnimAction\n};\n\nFire._RFpop();\n},{}],\"BattleMng\":[function(require,module,exports){\nFire._RFpush(module, '5e1eerr6JZIZIl2FzoR6XBb', 'BattleMng');\n// scripts/BattleMng.js\n\n'use strict';\n\nfunction getRandomInt(min, max) {\n    return Math.floor(Math.random() * (max - min)) + min;\n}\n\nvar BattleMng = Fire.Class({\n    'extends': Fire.Behavior,\n    onLoad: function onLoad() {\n        // uimanager\n        this.uiManager = Fire.engine.getCurrentSceneN().getChildByName('uiLayer');\n        // fighters\n        this.fighters = this.getChildren();\n        this.players = [];\n        this.enemies = [];\n        for (var i = 0; i < this.fighters.length; ++i) {\n            var fighter = this.fighters[i];\n            if (fighter.isEnemy) {\n                this.enemies.push(fighter);\n            } else {\n                this.players.push(fighter);\n            }\n        }\n        this.registerInput();\n    },\n\n    registerInput: function registerInput() {\n        var self = this;\n        cc.eventManager.addListener({\n            event: cc.EventListener.KEYBOARD,\n            onKeyPressed: function onKeyPressed(keyCode, event) {\n                if (keyCode === cc.KEY.space) {\n                    self.launchRandomAttack();\n                }\n            }\n        }, self);\n        cc.eventManager.addListener({\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            onTouchBegan: function onTouchBegan(touch, event) {\n                self.launchRandomAttack();\n            }\n        }, self);\n    },\n\n    launchRandomAttack: function launchRandomAttack() {\n        var availableFighters = this.fighters.filter(function (fighter) {\n            return fighter.canMove;\n        });\n        var count = availableFighters.length;\n        if (count > 1) {\n            var randIdx = getRandomInt(0, count);\n            var attacker = availableFighters[randIdx];\n            attacker.canMove = false;\n            var target = null;\n            for (var i = 0; i < availableFighters.length; ++i) {\n                if (attacker.isEnemy !== availableFighters[i].isEnemy) {\n                    target = availableFighters[i];\n                    break;\n                }\n            }\n            if (target) {\n                attacker.moveToAttack(target);\n                this.uiManager.playPop(this.fighters.indexOf(attacker));\n            } else {\n                attacker.canMove = true;\n            }\n        }\n    }\n});\n\nFire._RFpop();\n},{}],\"FXManager\":[function(require,module,exports){\nFire._RFpush(module, '614263AlCBKqKbCvMD2ExRn', 'FXManager');\n// scripts/FXManager.js\n\n\"use strict\";\n\nvar Animation = require('Animation');\n\nvar FXType = Fire.defineEnum({\n    Blood: -1,\n    Boom: -1,\n    Dust: -1,\n    Hit: -1,\n    Flash: -1\n});\n\nvar animData = [{\n    name: \"blood_splash_\",\n    count: 3,\n    startIdx: 1,\n    delay: 0.05\n}, {\n    name: \"boom_0\",\n    count: 6,\n    startIdx: 1,\n    delay: 0.1\n}, {\n    name: \"fog_0\",\n    count: 7,\n    startIdx: 1,\n    delay: 0.1\n}, {\n    name: \"hit_0\",\n    count: 4,\n    startIdx: 1,\n    delay: 0.05\n}, {\n    name: \"coin_gather_\",\n    count: 3,\n    startIdx: 1,\n    delay: 0.07\n}];\n\nvar getAnimInfo = function getAnimInfo(fxType) {\n    return animData[fxType];\n};\n\nvar SimpleFX = cc.Sprite.extend({\n    ctor: function ctor(parent, type) {\n        this._super();\n        SimpleFX.fxID++;\n        this.fxID = SimpleFX.fxID;\n        parent.addChild(this);\n        var nameStr = 'fx_' + FXType[type] + this.fxID;\n        // Fire.log(nameStr);\n        this.setName(nameStr);\n        var animAction = Animation.createAnimAction(getAnimInfo(type));\n        var callback = cc.callFunc(this.onPlayEnd, this);\n        this.runAction(cc.sequence(animAction, callback));\n    },\n    newAnim: function newAnim(type) {\n        var animAction = Animation.createAnimAction(getAnimInfo(type));\n        var callback = cc.callFunc(this.onPlayEnd, this);\n        this.runAction(cc.sequence(animAction, callback));\n    },\n    onPlayEnd: function onPlayEnd() {\n        this.removeFromParent();\n        cc.pool.putInPool(this);\n    }\n});\nSimpleFX.fxID = 0;\n\nvar FXManager = Fire.Class({\n    \"extends\": Fire.Behavior,\n    statics: {\n        FXType: FXType,\n        getAnimInfo: getAnimInfo\n    },\n    properties: {\n        fxAtlasAsset: {\n            \"default\": \"\",\n            url: Runtime.SpriteAtlas\n        }\n    },\n    onLoad: function onLoad() {\n        if (this.fxAtlasAsset) {\n            cc.spriteFrameCache.addSpriteFrames(this.fxAtlasAsset);\n        }\n        FXManager.instance = this;\n    },\n    _spawnFX: function _spawnFX(parent, type) {\n        var fx;\n        if (cc.pool.hasObject(SimpleFX)) {\n            fx = cc.pool.getFromPool(SimpleFX);\n            fx.newAnim(type);\n            parent.addChild(fx);\n            return fx;\n        } else {\n            fx = new SimpleFX(this, type);\n            return fx;\n        }\n    },\n    playFX: function playFX(pos, type, scaleX, parent) {\n        var p = parent || this;\n        var fx = this._spawnFX(p, type);\n\n        if (type === FXType.Hit) {\n            fx.setScale(0.5);\n        } else {\n            fx.setScale(1);\n        }\n\n        if (scaleX > 0) {\n            scaleX = 1;\n        } else {\n            scaleX = -1;\n        }\n        fx.setScaleX(scaleX);\n        fx.setPosition(pos);\n        return fx;\n    }\n});\n\nFire._RFpop();\n},{\"Animation\":\"Animation\"}],\"Fighter\":[function(require,module,exports){\nFire._RFpush(module, 'd447fGdAC9J9IVvsX8QqEeH', 'Fighter');\n// scripts/Fighter.js\n\n'use strict';\n\nvar FXManager = require('FXManager');\n\nvar Fighter = Fire.Class({\n    'extends': Fire.Behavior,\n    properties: {\n        isEnemy: false,\n        moveForwardDuration: 0,\n        moveBackwardDuration: 0,\n        attackFreezeDuration: 0,\n        hurtFX: 0,\n        attackOffset: 0,\n        idleTexture: {\n            'default': null,\n            url: Fire.Texture\n        },\n        atkTexture: {\n            'default': null,\n            url: Fire.Texture\n        }\n    },\n\n    onLoad: function onLoad() {\n        // engage in action\n        this.canMove = true;\n        // target\n        this.targetFighter = null;\n        // z order\n        this.origZ = this.getLocalZOrder();\n        // flash sprite\n        this.flash = this.getChildByName('flash');\n        this.flash.setOpacity(0);\n        // actions\n        this.actionMoveForward = null;\n        this.actionMoveBackward = null;\n        this.actionIdle = cc.repeatForever(cc.sequence(cc.scaleTo(1, this.getScaleX(), 0.55), cc.scaleTo(1, this.getScaleX(), 0.6)));\n        // position\n        this.targetPos = cc.p(0, 0);\n        this.selfPos = cc.p(this.x, this.y);\n        this.actionMoveBackward = cc.moveTo(this.moveBackwardDuration, this.selfPos).easing(cc.easeCubicActionOut());\n        this.idle();\n    },\n\n    idle: function idle() {\n        this.runAction(this.actionIdle);\n    },\n\n    moveToAttack: function moveToAttack(target) {\n        this.stopAction(this.actionIdle);\n        this.canMove = false;\n        this.setLocalZOrder(this.orgiZ + 0.5);\n        this._assignTarget(target, this.attackOffset);\n        var callback = cc.callFunc(this._playAttack, this);\n        var fx = FXManager.instance.playFX(cc.p(this.x, this.y + 50), FXManager.FXType.Dust, this.getScaleX(), this.getParent());\n        fx.setLocalZOrder(this.origZ - 0.5);\n        this.runAction(cc.sequence(this.actionMoveForward, callback));\n    },\n\n    hurt: function hurt(offset) {\n        this.stopAction(this.actionIdle);\n        this.canMove = false;\n        var move1 = cc.moveBy(this.attackFreezeDuration, cc.p(offset, 0)).easing(cc.easeElasticInOut(0.2));\n        var move2 = cc.moveBy(this.attackFreezeDuration, cc.p(-offset, 0)).easing(cc.easeElasticInOut(0.2));\n        var callback = cc.callFunc(this._onHurtEnd, this);\n        var seq1 = cc.sequence(move1, move2, callback);\n        var flash1 = cc.fadeIn(this.attackFreezeDuration / 2);\n        var flash2 = cc.fadeOut(this.attackFreezeDuration / 2);\n        var seq2 = cc.sequence(flash1, flash2);\n        FXManager.instance.playFX(cc.p(this.x + offset, this.y + 80), FXManager.FXType.Blood, this.getScaleX());\n        this.runAction(seq1);\n        this.flash.runAction(seq2);\n    },\n\n    _assignTarget: function _assignTarget(target, offset) {\n        this.targetFighter = target;\n        this.targetPos = cc.p(target.x + offset, target.y);\n        // this.actionMoveForward = cc.moveTo(this.moveForwardDuration, this.targetPos).easing(cc.easeCubicActionOut());\n        this.actionMoveForward = cc.jumpTo(this.moveForwardDuration, this.targetPos, 30, 1).easing(cc.easeCubicActionOut());\n    },\n\n    _showAtkPose: function _showAtkPose() {\n        this.setTexture(this.atkTexture);\n    },\n\n    _showIdlePose: function _showIdlePose() {\n        this.setTexture(this.idleTexture);\n    },\n\n    _playHitFreeze: function _playHitFreeze() {\n        var offset = this.attackOffset;\n        setTimeout((function () {\n            this._moveBack();\n        }).bind(this), this.attackFreezeDuration * 1000);\n    },\n\n    _playAttack: function _playAttack() {\n        var offset = this.attackOffset;\n        this._showAtkPose();\n        var callback = cc.callFunc(this._playHitFreeze, this);\n        var seq = cc.sequence(cc.moveBy(this.attackFreezeDuration / 4, cc.p(-offset, 0)), callback);\n        FXManager.instance.playFX(cc.p(this.x - offset, 0), FXManager.FXType.Hit, this.targetFighter.getScaleX());\n        this.runAction(seq);\n        this.targetFighter.hurt(-offset);\n    },\n\n    _moveBack: function _moveBack() {\n        this._showIdlePose();\n        var callback = cc.callFunc(this._onAtkEnd, this);\n        this.runAction(cc.sequence(this.actionMoveBackward, callback));\n    },\n\n    _onAtkEnd: function _onAtkEnd() {\n        this.setLocalZOrder(this.origZ);\n        this.canMove = true;\n        this.idle();\n    },\n\n    _onHurtEnd: function _onHurtEnd() {\n        this.canMove = true;\n        this.idle();\n    }\n});\n\nFire._RFpop();\n},{\"FXManager\":\"FXManager\"}],\"UIMng\":[function(require,module,exports){\nFire._RFpush(module, '5853cbzYTNCAo3RbX4Qepgh', 'UIMng');\n// scripts/UIMng.js\n\n'use strict';\n\nvar FXManager = require('FXManager');\nvar UIMng = Fire.Class({\n    'extends': Fire.Behavior,\n    onLoad: function onLoad() {\n        //fx manager\n        // this.fxManager = FXManager.instance;\n        // fighters\n        this.icons = this.getChildren();\n        this.playerIcons = [];\n        this.enemyIcons = [];\n        this.origScale = 0.25;\n        for (var i = 0; i < this.icons.length; ++i) {\n            var icon = this.icons[i];\n            icon.setScale(this.origScale);\n        }\n        // scale\n        this.actionPop = cc.sequence(cc.scaleTo(0.2, this.origScale * 1.4).easing(cc.easeBackOut()), cc.scaleTo(0.2, this.origScale).easing(cc.easeBackOut()));\n    },\n    playPop: function playPop(index) {\n        var icon = this.icons[index];\n        if (icon) {\n            icon.runAction(this.actionPop);\n            var fx = FXManager.instance.playFX(cc.p(icon.x, icon.y), FXManager.FXType.Flash, 1);\n        }\n    }\n});\n\nFire._RFpop();\n},{\"FXManager\":\"FXManager\"}]},{},[\"Animation\",\"UIMng\",\"BattleMng\",\"FXManager\",\"Fighter\"]);\n"],"sourceRoot":"/source/"}